BEGIN;

-- Core Tables
CREATE TABLE Cve (
    id VARCHAR(16) NOT NULL PRIMARY KEY, 
    cvss REAL NULL,
    belonging VARCHAR(10) DEFAULT "ENTERPRISE", 
    published_date TIMESTAMP DEFAULT current_timestamp
);

CREATE TABLE Description (
    id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, 
    _description TEXT NOT NULL, 
    _source VARCHAR(64) NOT NULL, 
    _priority INTEGER NOT NULL,
    cve_id VARCHAR(16) NOT NULL,
    FOREIGN KEY(cve_id) REFERENCES Cve(id) 
);

CREATE TABLE Link (
    id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, 
    uri VARCHAR(200) NOT NULL, 
    cve_id VARCHAR(16) NOT NULL,
    FOREIGN KEY(cve_id) REFERENCES Cve(id) 
);

CREATE TABLE Cwe (
    id INTEGER NOT NULL PRIMARY KEY, 
    _description TEXT NOT NULL
);
--

-- CPE Section
CREATE TABLE Vendor (
    id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, 
    _name VARCHAR(128) NOT NULL UNIQUE
);

CREATE TABLE Product (
    id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, 
    _name VARCHAR(128) NOT NULL UNIQUE, 
    vendor_id bigint NOT NULL,
    FOREIGN KEY(vendor_id) REFERENCES Vendor(id) 
);

CREATE TABLE Cpe (
    id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, 
    _value VARCHAR(128) NOT NULL, 
    vendor_id int NOT NULL,
    product_id int NOT NULL,
    FOREIGN KEY(vendor_id) REFERENCES Vendor(id),
    FOREIGN KEY(product_id) REFERENCES Product(id)
);
--

-- Mitre ATT&CK
CREATE TABLE MitreTechnique (
    id INTEGER NOT NULL PRIMARY KEY, 
    _description TEXT NOT NULL, 
    belonging VARCHAR(10) DEFAULT "ENTERPRISE"
);
--

-- Managment
CREATE TABLE Event (
    id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, 
    event_date date NOT NULL, 
    source VARCHAR(64) NOT NULL, 
    cve_id VARCHAR(16) NOT NULL,
    FOREIGN KEY(cve_id) REFERENCES Cve(id)
);
--

COMMIT;